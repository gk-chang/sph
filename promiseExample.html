<!DOCTYPE html>

<head>
    Promise Example
    <br>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <!-- <link crossorigin=""> -->
</head>

<body>
    <div class="container">
        <h2 class="page-header">初体验</h2>
        <hr>
        <button class="btn btnp" id="btn">点我抽奖</button>
    </div>
    <script>
        // function rand(m, n)
        // {
        //     return Math.ceil(Math.random() * (m - n + 1) + n - 1);
        // }

        // const btn = document.querySelector('#btn');
        // btn.addEventListener('click', ()=>{
        //     // setTimeout(()=>{
        //     //     let x = rand(100, 1);
        //     //     if(x < 50){
        //     //         alert(`恭喜中奖 x是${x}`)
        //     //     }else{
        //     //         alert(`再来一次 x是${x}`)
        //     //     }
        //     // },2000)
        //     const p = new Promise((resolve, reject) =>{
        //         setTimeout(()=>{
        //             let x = rand(100, 1);
        //             // debugger;
        //             if(x < 50){
        //                 // alert(`恭喜中奖 x是${x}`)
        //                 resolve(x);
        //             }else{
        //                 // alert(`再来一次 x是${x}`)
        //                 reject(x);
        //             }
        //         },1000)
        //     }
        //     )
        //     p.then((x)=>{
        //         alert(`恭喜中奖 x是${x}`)
        //     },(x)=>{
        //         alert(`再来一次 x是${x}`)
        //     })
        // })

        const btn = document.getElementById(btn);
        btn.addEventListener("click", () =>
        {

            const p = new Promise((resolve, reject) =>
            {
                () =>
                {
                    const xhr = new XMLHttpRequest();
                    xhr.open('GET', 'https://api.apiopen.top/getJoke');
                    xhr.send();
                    xhr.onreadystatechange = function ()
                    {
                        if (xhr.readyState === 4) {
                            if (xhr.status == 200) {
                                // console.log(xhr.response);
                                resolve(xhr.response);
                            } else {
                                // console.log(xhr.status);
                                reject(xhr.status);

                            }
                        }
                    }
                }
            })
        })
        p.then((value)=>{

        },(reason)=>{

        })


    </script>
</body>